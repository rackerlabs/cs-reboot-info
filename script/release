#!/bin/bash

set -e

ROOT=$(dirname $0)/..
cd ${ROOT}

if [ -z ${RAX_API_KEY} ]; then
  echo "You must provide RAX_API_KEY to publish."
  exit 1
fi

git pull
script/cross
script/checksum
cdn_ssl_base_url=$(script/publish-to-test | grep 'cdn_ssl_base_url' | awk '{print $2}')
script/verify-sha1 $cdn_ssl_base_url
if [$? -ne 0]; then
    exit $?
fi
app_version=$(script/publish-to-prod | grep 'app_version_published' | awk '{print $2}')
script/update-version-in-readme $app_version
